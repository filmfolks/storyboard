<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FILM FOLKS STORYBOARD</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; background: #fafafa; margin: 0; }
.dark-mode { background: #121212 !important; color: #fff !important; }
.dark-mode .storyboard-container { background: #181818 !important; color: #fff !important; }
.dark-mode input, .dark-mode textarea, .dark-mode select { background: #222 !important; color: #fff !important; border-color: #555 !important; }
.dark-mode .storyboard-panel { background: #222 !important; color: #fff !important; }
.dark-mode .preview-shot { background: #222 !important; color: #fff !important; }
.dark-mode .preview-header, .dark-mode .preview-shot * { color: #fff !important; }
.storyboard-container { max-width: 1200px; margin: 20px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 10px #bbb; padding: 16px; color: #111; }
.top-section { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; margin-bottom: 20px; }
.top-fields { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
.top-fields input { font-size: 16px; padding: 6px 9px; border: 1px solid #bbb; border-radius: 4px; width: 200px; }
.saved-header { display: none; text-align: center; }
.saved-title { font-size: 18px; font-weight: bold; letter-spacing: 1px; }
.saved-director,.saved-sequence { font-size: 13px; margin: 0 8px; }
button { border: none; border-radius: 4px; padding: 8px 14px; cursor: pointer; font-size: 18px;}
.save-btn { background: #28a745; color: #fff; font-size:18px;}
.edit-btn { background: #ffc107; color: #212529;}
.edit-btn:before { content:'E'; font-weight:bold;}
#pdfBtn { background: #555; color: #fff; margin-left:8px;}
#pdfBtn:before { content:'S';}
#previewModeBtn { background: #037bf0; color: #fff; font-size:18px;}
#previewModeBtn:before { content:'P';}
#darkModeBtn { background: #333; color: #fff; margin-left:10px;}
#darkModeBtn:before { content:'ðŸŒ™';}
#exitPreviewBtn { background: #c72b2b; color: white; margin-left:6px;}
.add-shot-main { background: #2274a5; color: white; margin-left:6px; font-size: 24px; padding: 4px 10px; height: fit-content; align-self: flex-start; }
.storyboard-row { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; justify-content: flex-start; align-items: flex-start; }
.storyboard-panel { background: #f4f4f4; border-radius: 8px; padding: 12px; display: flex; flex-direction: column; align-items: center; box-sizing: border-box; break-inside: avoid; page-break-inside: avoid; width: 220px; }
.storyboard-thumbnail { width: 190px; height: 120px; background: #ddd; border-radius: 4px; object-fit: cover; margin-top: 6px; }
.panel-label { font-weight: bold; width: 100%; margin: 5px 0 3px; }
input,textarea,select { width: 100%; font-size: 15px; padding: 4px 7px; border-radius: 3px; border: 1px solid #ccc; margin-bottom: 8px; }
textarea { resize: vertical; }
#previewArea { display: none; text-align: center; max-width: 1000px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px #bbb; color: #222;}
.preview-header { text-align: center; margin-bottom: 20px; font-size: 20px; font-weight: bold; }
.preview-shots { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
.preview-shot { width: 45%; min-width: 300px; border: 1px solid #ddd; border-radius: 8px; padding: 15px; box-sizing: border-box; text-align: center; font-family: 'Courier New', monospace; font-size: 12pt; color: #222;}
.preview-shot img { max-width: 100%; height: auto; border-radius: 4px; display: block; margin: 0 auto; background:#222;}
.preview-shot .preview-text { font-weight: bold; margin: 10px 0 6px; }
.preview-shot .preview-desc { margin-top: 10px; white-space: pre-wrap; }
#previewControls { margin-top: 24px; text-align: center; }
#previewPrintBtn { background: #2274a5; color: white; margin-right: 10px; padding: 8px 16px; border-radius: 6px; border: none; font-size:18px;}
#previewPrintBtn:before { content:'S';}
#previewPrintBtn:hover { background-color: #174668; }
@media (max-width: 768px) { .storyboard-panel { width: 95%; } .storyboard-thumbnail { width: 100%; height: auto; } .add-shot-main { display: block; margin: 10px auto; } }
@media print {
  body { background: #fff !important; color: #000 !important;}
  #previewArea { background:#fff !important; color:#000 !important;}
  .preview-header, .preview-shot { color:#000 !important;}
  button, input, textarea, select, .panel-label, .add-shot-main, .add-shot-mobile, #previewModeBtn, #exitPreviewBtn, #darkModeBtn, #pdfBtn, #bottomControls, #mainStoryboard { display: none !important; }
  .preview-header {display:block !important; font-size:22px !important; color:#000 !important;}
  .preview-shot {font-size:12pt !important; color:#000 !important; width: 180px !important; min-width:120px !important; padding:5px !important;}
  .preview-shot img {max-width:85px !important; height:50px !important;}
}
</style>
</head>
<body>
<div class="storyboard-container" id="mainStoryboard">
  <div class="top-section">
    <div class="top-fields" id="editFields">
      <input type="text" id="titleField" placeholder="Storyboard Title" />
      <input type="text" id="directorField" placeholder="Director Name" />
      <input type="text" id="sequenceField" placeholder="Sequence" />
      <button class="save-btn" onclick="saveHeader()">Save</button>
    </div>
    <div class="saved-header" id="savedHeader">
      <div class="saved-title" id="savedTitle"></div>
      <span class="saved-director" id="savedDirector"></span>
      <span class="saved-sequence" id="savedSequence"></span>
    </div>
  </div>
  <div id="storyboardRows"></div>
  <div id="bottomControls">
    <button id="previewModeBtn" onclick="enterPreview()"></button>
    <button id="pdfBtn"></button>
    <button id="darkModeBtn" onclick="toggleDarkMode()"></button>
    <button class="edit-btn" id="editBtn" onclick="editHeader()"></button>
  </div>
</div>

<div id="previewArea">
  <div class="preview-header" id="previewHeader"></div>
  <div id="previewShotsContainer" class="preview-shots"></div>
  <div id="previewControls" style="margin-top: 15px; text-align: center;">
    <button id="previewPrintBtn"></button>
    <button id="exitPreviewBtn">Exit Preview</button>
  </div>
</div>

<script>
let panels = [], panelId = 0;
let isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
let focusedPanelId = null;

// Create single + button
const addBtn = document.createElement('button');
addBtn.className = 'add-shot-main';
addBtn.textContent = '+';
addBtn.onclick = addPanel;

function renderStoryboard() {
  const rows = document.getElementById("storyboardRows");
  rows.innerHTML = "";
  if (isMobile) {
    panels.forEach((panel) => {
      const wrap = document.createElement("div");
      wrap.className = "storyboard-row";
      wrap.appendChild(panel);
      const btn = document.createElement("button");
      btn.className = "add-shot-mobile";
      btn.textContent = "+";
      btn.onclick = addPanel;
      wrap.appendChild(btn);
      rows.appendChild(wrap);
    });
  } else {
    let row = document.createElement("div");
    row.className = "storyboard-row";
    panels.forEach((panel, idx) => {
      row.appendChild(panel);
      // Add focus listeners to inputs in panel
      const inputs = panel.querySelectorAll('input, textarea, select');
      inputs.forEach((input) => {
        input.addEventListener('focus', () => {
          focusedPanelId = idx;
          moveAddBtn(panel);
        });
      });
      if (row.children.length === 5) {
        rows.appendChild(row);
        row = document.createElement("div");
        row.className = "storyboard-row";
      }
    });
    if (row.children.length > 0) {
      rows.appendChild(row);
    }
    // Append + button to last row or new row if empty
    if (panels.length === 0) {
      row = document.createElement("div");
      row.className = "storyboard-row";
      row.appendChild(addBtn);
      rows.appendChild(row);
    } else {
      const lastRow = rows.lastChild;
      lastRow.appendChild(addBtn);
    }
  }
}

// Move + button next to the focused/edited panel
function moveAddBtn(currentPanel) {
  const allRows = document.querySelectorAll('.storyboard-row');
  allRows.forEach(row => row.removeChild(addBtn));
  const currentRow = currentPanel.parentNode;
  currentRow.insertBefore(addBtn, currentPanel.nextSibling); // Place right next to current panel
}

function addPanel() {
  panelId++;
  const panel = document.createElement("div");
  panel.className = "storyboard-panel";
  panel.innerHTML = `
    <label class="panel-label">Shot Number</label>
    <input type="text" id="scene${panelId}" oninput="syncLabels(${panelId})" />
    <label class="panel-label">Shot Size</label>
    <select id="shotSize${panelId}" onchange="syncLabels(${panelId})">
      <option value="">-- Select --</option>
      <option>Extreme Long Shot (ELS)</option>
      <option>Long (LS) / Wide (WS)</option>
      <option>Medium Long (MLS) / Medium Wide (MWS)</option>
      <option>Full Shot (FS)</option>
      <option>Medium Shot (MS)</option>
      <option>Medium Close-Up (MCU)</option>
      <option>Close-Up (CU)</option>
      <option>Extreme Close-Up (ECU)</option>
      <option>Cowboy Shot (CS)</option>
      <option>Choker Shot</option>
      <option>Establishing Shot</option>
    </select>
    <label class="panel-label">Camera Angle</label>
    <select id="camAngle${panelId}" onchange="syncLabels(${panelId})">
      <option value="">-- Select --</option>
      <option>Eye-Level</option>
      <option>High Angle</option>
      <option>Low Angle</option>
      <option>Bird's-Eye View / Overhead</option>
      <option>Worm's-Eye View</option>
      <option>Dutch Angle / Canted Angle</option>
    </select>
    <label class="panel-label">Framing & Composition</label>
    <select id="framing${panelId}" onchange="syncLabels(${panelId})">
      <option value="">-- Select --</option>
      <option>Single Shot</option>
      <option>Two-Shot</option>
      <option>Three-Shot</option>
      <option>Over-the-Shoulder (OTS)</option>
      <option>Point-of-View (POV)</option>
      <option>Master Shot</option>
    </select>
    <label class="panel-label">Camera Movement</label>
    <select id="camMovement${panelId}" onchange="syncLabels(${panelId})">
      <option value="">-- Select --</option>
      <option>Static Shot</option>
      <option>Pan</option>
      <option>Tilt</option>
      <option>Tracking Shot / Dolly Shot</option>
      <option>Zoom Shot</option>
      <option>Dolly Zoom</option>
      <option>Truck Shot</option>
      <option>Pedestal Shot</option>
      <option>Roll Shot</option>
    </select>
    <label class="panel-label">Focus Technique</label>
    <select id="focusTech${panelId}" onchange="syncLabels(${panelId})">
      <option value="">-- Select --</option>
      <option>Rack Focus / Focus Pull</option>
      <option>Shallow Focus</option>
      <option>Deep Focus</option>
      <option>Soft Focus</option>
      <option>Tilt-Shift</option>
      <option>Split Diopter</option>
    </select>
    <label class="panel-label">Description</label>
    <textarea id="desc${panelId}" oninput="syncLabels(${panelId})"></textarea>
    <input type="file" accept="image/*" id="img${panelId}" onchange="previewImg(event, ${panelId})" />
    <img id="thumb${panelId}" class="storyboard-thumbnail" style="display:none;" />
    <span class="print-shotname" id="printShot${panelId}" style="display:none;"></span>
    <span class="print-select" id="printSelects${panelId}" style="display:none;"></span>
    <span class="print-description" id="printDesc${panelId}" style="display:none;"></span>
  `;
  panels.push(panel);
  renderStoryboard();
  // After adding, move + to new panel
  moveAddBtn(panel);
  panel.querySelector('input').focus(); // Focus new panel
}

function syncLabels(id) {
  const scene = document.getElementById(`scene${id}`).value.trim();
  const selections = [
    document.getElementById(`shotSize${id}`).value,
    document.getElementById(`camAngle${id}`).value,
    document.getElementById(`framing${id}`).value,
    document.getElementById(`camMovement${id}`).value,
    document.getElementById(`focusTech${id}`).value
  ].filter(Boolean).join(", ");
  document.getElementById(`printShot${id}`).textContent = scene ? scene + "." : "";
  document.getElementById(`printDesc${id}`).textContent = capitalizeWords(document.getElementById(`desc${id}`).value.trim());
  const selectsSpan = document.getElementById(`printSelects${id}`);
  selectsSpan.style.display = "none";
  selectsSpan.textContent = selections;
}

function previewImg(e, id) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    const img = document.getElementById(`thumb${id}`);
    img.src = ev.target.result;
    img.style.display = "block";
  };
  reader.readAsDataURL(file);
}

function saveHeader() {
  document.getElementById("savedTitle").textContent = document.getElementById("titleField").value.toUpperCase();
  document.getElementBy, document.getElementById("savedDirector").textContent = capitalizeWords(document.getElementById("directorField").value);
  document.getElementById("savedSequence").textContent = capitalizeWords(document.getElementById("sequenceField").value);
  document.getElementById("editFields").style.display = "none";
  document.getElementById("savedHeader").style.display = "block";
  document.getElementById('editBtn').style.display = 'inline-block';
}

function editHeader() {
  document.getElementById("editFields").style.display = "flex";
  document.getElementById("savedHeader").style.display = "none";
  document.getElementById("titleField").focus();
}

function capitalizeWords(str) {
  return str.replace(/\w\S*/g, (t) => t.charAt(0).toUpperCase() + t.substr(1).toLowerCase());
}

// Preview Mode: Show all shots in 2 per row on desktop; use all white text in dark mode
function enterPreview() {
  const previewArea = document.getElementById('previewArea');
  const container = document.getElementById('previewShotsContainer');
  container.innerHTML = '';
  panels.forEach((panel, idx) => {
    const shotNum = document.getElementById(`scene${idx + 1}`).value.trim();
    const selects = document.getElementById(`printSelects${idx + 1}`).textContent;
    const desc = document.getElementById(`desc${idx + 1}`).value.trim();
    const imgSrc = document.getElementById(`thumb${idx + 1}`).src || '';
    const shotDiv = document.createElement('div');
    shotDiv.className = 'preview-shot';
    shotDiv.innerHTML = `
      <div class="preview-text">${shotNum ? shotNum + '.' : ''}</div>
      <div class="preview-text">${selects}</div>
      ${imgSrc ? `<img src="${imgSrc}" alt="Shot Image">` : ''}
      <div class="preview-desc">${desc}</div>
    `;
    container.appendChild(shotDiv);
  });
  // Add header to preview
  const previewHeader = document.getElementById('previewHeader');
  previewHeader.innerHTML = `
    <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">${document.getElementById("savedTitle").textContent}</div>
    <div>${document.getElementById("savedDirector").textContent}</div>
    <div>${document.getElementById("savedSequence").textContent}</div>
  `;
  previewArea.style.display = 'block';
  document.getElementById('mainStoryboard').style.display = 'none';
}

function exitPreview() {
  document.getElementById('previewArea').style.display = 'none';
  document.getElementById('mainStoryboard').style.display = 'block';
}

document.getElementById('previewModeBtn').onclick = enterPreview;
document.getElementById('exitPreviewBtn').onclick = exitPreview;

document.getElementById('previewPrintBtn').onclick = () => {
  const previewArea = document.getElementById('previewArea');
  const originalContents = document.body.innerHTML;
  document.body.innerHTML = previewArea.innerHTML;
  window.print();
  document.body.innerHTML = originalContents;
  window.location.reload();
};

document.getElementById('pdfBtn').onclick = () => {
  enterPreview();
  setTimeout(() => {
    document.getElementById('previewPrintBtn').click();
    exitPreview();
  }, 250);
};

function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
}

// Initialize with panels (1 for mobile, 5 desktop)
for (let i = 0; i < (isMobile ? 1 : 5); i++) addPanel();

document.getElementById('editBtn').style.display = "none";
</script>
</body>
</html>
